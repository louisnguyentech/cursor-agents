Optimize the selected code.

FOCUS:
- Performance
- MongoDB query efficiency
- Index usage
- Reduce memory usage
- Keep API unchanged
